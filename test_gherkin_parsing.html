<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gherkin Parsing Test</title>
  <style>
    body {
      font-family: 'Consolas', 'Monaco', monospace;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .section {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
    }
    h2 {
      margin-top: 0;
      color: #333;
    }
    textarea {
      width: 100%;
      min-height: 300px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    button {
      background: #1A8A85;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
    }
    button:hover {
      background: #15736E;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h1>Gherkin Parsing Test</h1>
  <p>Test the JSON stringify to Gherkin format conversion</p>
  
  <div class="container">
    <div class="section">
      <h2>Input (JSON Stringify Format)</h2>
      <textarea id="input" placeholder='Paste JSON stringify format here, e.g.:
[{"content":"Given user logged in\\nAnd user navigated to dashboard\\nWhen user clicks button\\nThen result is shown"}]'></textarea>
      <button onclick="parseGherkin()">Parse to Gherkin</button>
    </div>
    
    <div class="section">
      <h2>Output (Formatted Gherkin)</h2>
      <textarea id="output" readonly></textarea>
    </div>
  </div>
  
  <div style="margin-top: 20px;">
    <h2>Test Examples</h2>
    <button onclick="testExample1()">Example 1: Basic JSON</button>
    <button onclick="testExample2()">Example 2: With Escaped Quotes</button>
    <button onclick="testExample3()">Example 3: Plain Text</button>
  </div>

  <script>
    function parseJsonStringifyToGherkin(jsonString) {
      if (!jsonString || jsonString.trim() === "") {
        return "";
      }
      
      try {
        let content = jsonString;
        
        // Check if it starts with [{"content": and extract the content
        if (jsonString.startsWith('[{"content":"') || jsonString.startsWith('[{\\"content\\":\\"')) {
          const parsed = JSON.parse(jsonString);
          if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].content) {
            content = parsed[0].content;
          }
        }
        
        // Replace \n with actual newlines
        content = content.replace(/\\n/g, '\n');
        
        // Split by newlines and clean up
        const lines = content.split('\n')
          .map(line => line.trim())
          .filter(line => line.length > 0);
        
        // Format as proper Gherkin
        const formatted = [];
        
        for (const line of lines) {
          // Check if line starts with Given/When/Then/And
          if (line.match(/^(Given|When|Then|And|But)\s+/i)) {
            formatted.push(line);
          } else {
            // If it doesn't start with keyword, add "And " prefix
            formatted.push(`And ${line}`);
          }
        }
        
        return formatted.join('\n');
      } catch (e) {
        // If parsing fails, just clean up the string
        return jsonString
          .replace(/\\n/g, '\n')
          .replace(/\\"/g, '"')
          .replace(/^\[{"content":"/, '')
          .replace(/"}]$/, '')
          .trim();
      }
    }

    function formatGherkinForDisplay(text) {
      if (!text || text.trim() === "") {
        return "";
      }
      
      const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
      const formatted = [];
      
      for (const line of lines) {
        if (line.match(/^Given\s+/i)) {
          formatted.push(`Given ${line.substring(6)}`);
        } else if (line.match(/^When\s+/i)) {
          formatted.push(`When ${line.substring(5)}`);
        } else if (line.match(/^Then\s+/i)) {
          formatted.push(`Then ${line.substring(5)}`);
        } else if (line.match(/^And\s+/i)) {
          formatted.push(`  And ${line.substring(4)}`);
        } else if (line.match(/^But\s+/i)) {
          formatted.push(`  But ${line.substring(4)}`);
        } else {
          // If no keyword, treat as continuation
          formatted.push(`  And ${line}`);
        }
      }
      
      return formatted.join('\n');
    }

    function parseGherkin() {
      const input = document.getElementById('input').value;
      const parsed = parseJsonStringifyToGherkin(input);
      const formatted = formatGherkinForDisplay(parsed);
      document.getElementById('output').value = formatted;
    }

    function testExample1() {
      const example = '[{"content":"Given user logged in\\nAnd user navigated to dashboard\\nWhen user clicks button\\nThen result is shown"}]';
      document.getElementById('input').value = example;
      parseGherkin();
    }

    function testExample2() {
      const example = '[{\\"content\\":\\"Given user is on homepage\\\\nWhen user enters credentials\\\\nAnd user clicks login\\\\nThen user sees dashboard\\"}]';
      document.getElementById('input').value = example;
      parseGherkin();
    }

    function testExample3() {
      const example = 'Given user is authenticated\nWhen user performs action\nThen system responds';
      document.getElementById('input').value = example;
      parseGherkin();
    }
  </script>
</body>
</html>
